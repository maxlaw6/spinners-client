


  
  
  Spinners Domino Game
  
  
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }
    canvas {
      border: 2px solid #333;
    }
    #status {
      margin-top: 10px;
      font-size: 18px;
      color: #333;
      max-width: 600px;
      text-align: center;
    }
    #playerSetup, #controls {
      margin-bottom: 10px;
    }
    button {
      margin-left: 10px;
      padding: 5px 10px;
    }
    input[type="text"] {
      margin: 5px;
      padding: 5px;
    }
  


  
    Number of Players (2-8): 
    
    
    Join Game
  
  
    Draw
  
  Enter player names and join game
  
    let ws;
    let playerId = null;
    let gameState = null;
    let selectedDomino = null;

<pre><code>// Color mapping for numbers 0-9 and spinner
const colors = [
  &#39;#FFFFFF&#39;, &#39;#FF6666&#39;, &#39;#66FF66&#39;, &#39;#6666FF&#39;, &#39;#FFFF66&#39;,
  &#39;#FF66FF&#39;, &#39;#66FFFF&#39;, &#39;#FF9933&#39;, &#39;#9933FF&#39;, &#39;#33CC33&#39;, &#39;#FFD700&#39;
];

// Dot patterns for numbers 0-9
const dotPatterns = [
  [], [[0, 0]], [[-1, -1], [1, 1]], [[-1, -1], [0, 0], [1, 1]],
  [[-1, -1], [-1, 1], [1, -1], [1, 1]], [[-1, -1], [-1, 1], [0, 0], [1, -1], [1, 1]],
  [[-1, -1], [-1, 0], [-1, 1], [1, -1], [1, 0], [1, 1]],
  [[-1, -1], [-1, 0], [-1, 1], [0, 0], [1, -1], [1, 0], [1, 1]],
  [[-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 0], [1, 1]],
  [[-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 0], [0, 1], [1, -1], [1, 0], [1, 1]]
];

class Domino {
  constructor(a, b) {
    this.a = a;
    this.b = b;
    this.x = 0;
    this.y = 0;
    this.rotation = 0;
    this.placed = false;
    this.isSpinner = a === &#39;S&#39; &amp;&amp; b === &#39;S&#39;;
    this.connectedEnds = { left: null, right: null, top: null, bottom: null };
  }

  draw() {
    push();
    translate(this.x, this.y);
    rotate(radians(this.rotation));
    fill(colors[this.a === &#39;S&#39; ? 10 : this.a]);
    rect(-25, -15, 25, 30, 5);
    fill(colors[this.b === &#39;S&#39; ? 10 : this.b]);
    rect(0, -15, 25, 30, 5);
    stroke(0);
    line(0, -15, 0, 15);
    fill(0);
    noStroke();
    if (this.a === &#39;S&#39;) {
      beginShape();
      for (let i = 0; i &lt; 5; i++) {
        let angle = TWO_PI / 5 * i;
        vertex(-12.5 + 5 * cos(angle), 5 * sin(angle));
        angle += TWO_PI / 10;
        vertex(-12.5 + 2.5 * cos(angle), 2.5 * sin(angle));
      }
      endShape(CLOSE);
    } else {
      for (let [dx, dy] of dotPatterns[this.a]) {
        circle(-12.5 + dx * 5, dy * 5, 3);
      }
    }
    if (this.b === &#39;S&#39;) {
      beginShape();
      for (let i = 0; i &lt; 5; i++) {
        let angle = TWO_PI / 5 * i;
        vertex(12.5 + 5 * cos(angle), 5 * sin(angle));
        angle += TWO_PI / 10;
        vertex(12.5 + 2.5 * cos(angle), 2.5 * sin(angle));
      }
      endShape(CLOSE);
    } else {
      for (let [dx, dy] of dotPatterns[this.b]) {
        circle(12.5 + dx * 5, dy * 5, 3);
      }
    }
    pop();
  }

  isClicked(mx, my) {
    let dx = mx - this.x;
    let dy = my - this.y;
    return dx &gt; -25 &amp;&amp; dx &lt; 25 &amp;&amp; dy &gt; -15 &amp;&amp; dy &lt; 15;
  }
}

function setup() {
  createCanvas(800, 600);
  noLoop();
  // Initialize name inputs on page load
  document.addEventListener(&#39;DOMContentLoaded&#39;, () =&gt; {
    const numPlayersInput = document.getElementById(&#39;numPlayers&#39;);
    if (numPlayersInput) {
      updateNameInputs(numPlayersInput.value);
      numPlayersInput.addEventListener(&#39;change&#39;, () =&gt; {
        updateNameInputs(numPlayersInput.value);
      });
    } else {
      console.error(&#39;numPlayers input not found&#39;);
      document.getElementById(&#39;status&#39;).textContent = &#39;Error: Page setup failed. Please refresh.&#39;;
    }
  });
}

function draw() {
  if (!gameState) return;
  background(0, 100, 0);
  for (let domino of gameState.board) {
    new Domino(domino.a, domino.b).draw();
  }
  for (let i = 0; i &lt; gameState.players.length; i++) {
    if (Array.isArray(gameState.players[i])) {
      for (let domino of gameState.players[i]) {
        new Domino(domino.a, domino.b).draw();
      }
    }
  }
  if (selectedDomino) {
    selectedDomino.x = mouseX;
    selectedDomino.y = mouseY;
    selectedDomino.draw();
  }
}

function mousePressed() {
  if (!gameState || gameState.currentPlayer !== playerId) return;
  let hand = gameState.players[playerId];
  for (let domino of hand) {
    let d = new Domino(domino.a, domino.b);
    d.x = domino.x;
    d.y = domino.y;
    d.rotation = domino.rotation;
    if (!domino.placed &amp;&amp; d.isClicked(mouseX, mouseY)) {
      selectedDomino = d;
      selectedDomino.index = hand.indexOf(domino);
      break;
    }
  }
}

function mouseReleased() {
  if (selectedDomino &amp;&amp; gameState &amp;&amp; gameState.currentPlayer === playerId) {
    ws.send(JSON.stringify({
      type: &#39;play&#39;,
      playerId: playerId,
      dominoIndex: selectedDomino.index,
      x: mouseX,
      y: mouseY,
      rotation: selectedDomino.rotation
    }));
    selectedDomino = null;
  }
}

function keyPressed() {
  if (selectedDomino &amp;&amp; key === &#39;r&#39;) {
    selectedDomino.rotation = (selectedDomino.rotation + 90) % 360;
  }
}

function connectAndStart() {
  const numPlayersInput = document.getElementById(&#39;numPlayers&#39;);
  if (!numPlayersInput) {
    document.getElementById(&#39;status&#39;).textContent = &#39;Error: Number of players input not found. Please refresh.&#39;;
    return;
  }
  let numPlayers = parseInt(numPlayersInput.value);
  if (isNaN(numPlayers) || numPlayers &lt; 2 || numPlayers &gt; 8) {
    document.getElementById(&#39;status&#39;).textContent = &#39;Please select 2 to 8 players.&#39;;
    return;
  }

  // Ensure name inputs are created and updated
  updateNameInputs(numPlayers);
  let names = [];
  for (let i = 0; i &lt; numPlayers; i++) {
    const nameInput = document.getElementById(`name${i}`);
    if (!nameInput) {
      document.getElementById(&#39;status&#39;).textContent = `Error: Name input for Player ${i + 1} not found. Please try again.`;
      return;
    }
    // Force input update
    nameInput.dispatchEvent(new Event(&#39;input&#39;));
    let name = nameInput.value.trim();
    console.log(`Player ${i + 1} name: &quot;${name}&quot;`); // Debug
    if (!name) {
      document.getElementById(&#39;status&#39;).textContent = `Please enter a name for Player ${i + 1}.`;
      return;
    }
    names.push(name);
  }

  // Connect to WebSocket
  ws = new WebSocket(&#39;wss://spinners-server.onrender.com&#39;); // Update with your Render URL
  ws.onopen = () =&gt; {
    console.log(&#39;WebSocket connected&#39;);
    ws.send(JSON.stringify({ type: &#39;join&#39;, numPlayers, names }));
  };
  ws.onmessage = (event) =&gt; {
    const msg = JSON.parse(event.data);
    if (msg.type === &#39;playerId&#39;) {
      playerId = msg.playerId;
      document.getElementById(&#39;status&#39;).textContent = `Connected as Player ${playerId + 1}. Waiting for others...`;
    } else if (msg.type === &#39;state&#39;) {
      gameState = msg.state;
      document.getElementById(&#39;playerSetup&#39;).style.display = &#39;none&#39;;
      document.getElementById(&#39;controls&#39;).style.display = &#39;block&#39;;
      let statusText = `${gameState.playerNames[gameState.currentPlayer]}&#39;s Turn (Round ${10 - gameState.currentRound})`;
      if (gameState.doubleInPlay) {
        let matchNum = gameState.doubleInPlay.a === &#39;S&#39; ? gameState.currentRound : gameState.doubleInPlay.a;
        statusText += ` (Play on double ${matchNum} or spinner, ${3 - gameState.doubleCounter} left)`;
      }
      document.getElementById(&#39;status&#39;).textContent = statusText;
      loop();
    } else if (msg.type === &#39;gameOver&#39;) {
      let scoreText = `${msg.winner} Wins the Round!\nCumulative Scores:\n`;
      for (let i = 0; i &lt; gameState.playerNames.length; i++) {
        scoreText += `${gameState.playerNames[i]}: ${msg.scores[i]} points\n`;
      }
      scoreText += `Game Winner: ${msg.gameWinner} (Lowest Score: ${msg.scores[msg.winnerIndex]})`;
      document.getElementById(&#39;status&#39;).textContent = scoreText;
      noLoop();
    }
  };
  ws.onerror = (error) =&gt; {
    console.error(&#39;WebSocket error:&#39;, error);
    document.getElementById(&#39;status&#39;).textContent = &#39;Error connecting to server. Please try again.&#39;;
  };
  ws.onclose = () =&gt; {
    document.getElementById(&#39;status&#39;).textContent = &#39;Disconnected from server. Please refresh and try again.&#39;;
  };
}

function sendDraw() {
  if (gameState &amp;&amp; gameState.currentPlayer === playerId) {
    ws.send(JSON.stringify({ type: &#39;draw&#39;, playerId }));
  }
}

function updateNameInputs(numPlayers) {
  const nameInputs = document.getElementById(&#39;nameInputs&#39;);
  if (!nameInputs) {
    console.error(&#39;nameInputs element not found&#39;);
    document.getElementById(&#39;status&#39;).textContent = &#39;Error: Page setup failed. Please refresh.&#39;;
    return;
  }
  nameInputs.innerHTML = &#39;&#39;;
  for (let i = 0; i &lt; numPlayers; i++) {
    let input = document.createElement(&#39;input&#39;);
    input.type = &#39;text&#39;;
    input.id = `name${i}`;
    input.placeholder = `Player ${i + 1} Name`;
    input.addEventListener(&#39;input&#39;, () =&gt; {
      console.log(`Input updated for Player ${i + 1}: ${input.value}`);
    });
    nameInputs.appendChild(input);
  }
}
</code></pre>
<p>  
(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96344ef3fc95b996',t:'MTc1MzIwMTY3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
